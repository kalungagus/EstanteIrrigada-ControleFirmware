//***********************************************************************************************************************
//                              Estante Irrigada - Sensor Handling
//***********************************************************************************************************************
#ifndef APPLICATION_SENSOR_HANDLING
#define	APPLICATION_SENSOR_HANDLING

#include <xc.h>
#include "../Peripherals/ADC.h"
#include "../Peripherals/RTCC.h"
#include "../Peripherals/IOPorts.h"

//***********************************************************************************************************************
// Definições
//***********************************************************************************************************************
//=======================================================================================================================
// Tipos de habilitação
//=======================================================================================================================
#define CONTROL_DISABLED                0
#define SENSOR_ENABLED                  1
#define SENSOR_CONTROLS_VALVE           2
#define FORCE_VALVE_ON                  3
#define FORCE_VALVE_OFF                 4

//***********************************************************************************************************************
// Tipos de variáveis relacionadas ao módulo de gerenciamento de sensores
//***********************************************************************************************************************
//=======================================================================================================================
// Variável de amostras
//=======================================================================================================================
typedef struct
{
    DateTime_t      instant;
    uint16_t        value[6];
    uint8_t         state[6];
} Sample_t;

//=======================================================================================================================
// Configuração dos sensores
//=======================================================================================================================
typedef struct
{
    uint8_t         operation;
    adcChannel_t    sensorADC;
    IOPort_t        valvePin;
    uint8_t         lastState;
    uint16_t        minThreshold;
    uint16_t        maxThreshold;
} controlConfig_t;

//***********************************************************************************************************************
// Funções públicas do módulo
//***********************************************************************************************************************
extern void initTaskSensorHandling(uint16_t activityPinID, uint16_t enablePinID);
extern void taskSensorHandling(uint8_t *sendSamples, uint8_t *readSensors, uint8_t *valveActivated);

#endif /* APPLICATION_SENSOR_HANDLING */